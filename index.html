<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Path Drawing</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>
<body>
    <a-scene embedded arjs>
        <!-- Define AR content here -->
        <a-marker preset="hiro">
            <!-- Add content to display when marker is detected -->
            <a-entity id="path" line="start: 0 0 0; end: 0 0 0; color: red;"></a-entity>
        </a-marker>
        <a-entity camera></a-entity>

        <!-- Script to handle touch events and draw path -->
        <script>
            // Get reference to the path entity
            const path = document.querySelector('#path');

            // Variables for path drawing
            let isDrawing = false;
            let pathPoints = [];

            // Event listener for touch start
            document.addEventListener('touchstart', onTouchStart);

            function onTouchStart(event) {
                isDrawing = true;
                pathPoints = [];
                const touch = event.touches[0];
                const x = touch.clientX;
                const y = touch.clientY;
                addPointToPath(x, y);
            }

            // Event listener for touch move
            document.addEventListener('touchmove', onTouchMove);

            function onTouchMove(event) {
                if (isDrawing) {
                    const touch = event.touches[0];
                    const x = touch.clientX;
                    const y = touch.clientY;
                    addPointToPath(x, y);
                }
            }

            // Event listener for touch end
            document.addEventListener('touchend', onTouchEnd);

            function onTouchEnd() {
                isDrawing = false;
            }

            // Function to add a point to the path
            function addPointToPath(x, y) {
                // Convert screen coordinates to world coordinates
                const worldPos = new THREE.Vector3();
                const marker = document.querySelector('a-marker');
                const canvas = document.querySelector('a-scene').renderer.domElement;
                const canvasWidth = canvas.width;
                const canvasHeight = canvas.height;
                const camera = document.querySelector('[camera]');
                const cameraEl = camera.getObject3D('camera');
                const pos = new THREE.Vector3(x / canvasWidth * 2 - 1, - (y / canvasHeight) * 2 + 1, 0.5);
                pos.unproject(cameraEl);
                pos.sub(cameraEl.position).normalize();
                const distance = - cameraEl.position.z / pos.z;
                worldPos.copy(cameraEl.position).add(pos.multiplyScalar(distance));

                // Add point to path
                pathPoints.push(worldPos);

                // Update path visualization
                path.setAttribute('line', {
                    start: pathPoints[0].x + ' ' + pathPoints[0].y + ' ' + pathPoints[0].z,
                    end: worldPos.x + ' ' + worldPos.y + ' ' + worldPos.z,
                    color: 'red'
                });
            }
        </script>
    </a-scene>
</body>
</html>
